<html>

<head>
  <script src="https://code.jquery.com/jquery-1.8.2.js"></script>
  <script type="text/javascript" src="https://www.google.com/jsapi"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-csv/0.8.12/jquery.csv.js"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
  <script>
    google.load("visualization", "1", { packages: ["corechart", "table"] });
    google.setOnLoadCallback(drawChart);
    function drawChart() {
      var csv = $('#textInput').val();
      var data = $.csv.toArrays(csv, {
        onParseValue: $.csv.hooks.castToScalar
      });

      // Convert data for bar chart (summing all digits)
      var timeData = {};	// type -> table
      var funcRowMap;
      var maxDigit = 0;

      for (var i = 1; i < data.length; i++) {
        var type = data[i][0];
        var func = data[i][1];
        var digit = data[i][2];
        var time = data[i][3];
        if (timeData[type] == null) {
          timeData[type] = [["Function", "Time (ns)"/*, { role: "style" }*/]];
          if (digit != 0)
            funcRowMap = {};
        }

        var table = timeData[type];

        if (digit != 0) {
          if (funcRowMap[func] == null)
            funcRowMap[func] = table.push([func, 0]) - 1;

          table[funcRowMap[func]][1] += time;
        }
        else
          table.push([func, time]);

        maxDigit = Math.max(maxDigit, digit);
      }

      // Compute average
      for (var type in timeData) {
        var table = timeData[type];
        for (var i = 1; i < table.length; i++)
          table[i][1] /= maxDigit;
      }

      // Convert data for drawing line chart per random digit
      var timeDigitData = {}; // type -> table
      var funcColumnMap;

      for (var i = 1; i < data.length; i++) {
        var type = data[i][0];
        var func = data[i][1];
        var digit = data[i][2];
        var time = data[i][3];

        if (digit == 0)
          continue;

        if (timeDigitData[type] == null) {
          timeDigitData[type] = [["Digit"]];
          funcColumnMap = {};
        }

        var table = timeDigitData[type];

        if (funcColumnMap[func] == null)
          funcColumnMap[func] = table[0].push(func) - 1;

        var row;
        for (row = 1; row < table.length; row++)
          if (table[row][0] == digit)
            break;

        if (row == table.length)
          table.push([digit]);

        table[row][funcColumnMap[func]] = time;
      }

      for (var type in timeData) {
        $("#main").append(
          $("<a>", { name: type }),
          $("<h2>", { style: "padding-top: 70px; margin-top: -70px;" }).append(type)
        );

        $("#section").append($("<li>").append($("<a>", { href: "#" + type }).append(type)));

        drawTable(type, timeData[type]);
        drawBarChart(type, timeData[type]);
        if (timeDigitData[type] != null)
          drawDigitChart(type, timeDigitData[type]);
      }

      $(".chart").each(function () {
        var chart = $(this);
        var d = $("#downloadDD").clone().css("display", "");
        $('li a', d).each(function () {
          $(this).click(function () {
            var svg = chart[0].getElementsByTagName('svg')[0].parentNode.innerHTML;
            svg = sanitize(svg);
            $('#imageFilename').val($("#title").html() + "_" + chart.data("filename"));
            $('#imageGetFormTYPE').val($(this).attr('dltype'));
            $('#imageGetFormSVG').val(svg);
            $('#imageGetForm').submit();
          });
        });
        $(this).after(d);
      });

      // Add configurations
      var thisConfig = "apple-m1-pro_macos_clang17.0";
      var configurations = [];

      for (var i in configurations) {
        var c = configurations[i];
        $("#configuration").append($("<li>", { class: (c == thisConfig ? "active" : "") }).append($("<a>", { href: c + ".html" }).append(c)));
      }
    }

    function drawTable(type, timeData) {
      var data = google.visualization.arrayToDataTable(timeData);
      data.addColumn('number', 'Speedup');
      data.sort([{ column: 1, desc: true }]);
      var formatter1 = new google.visualization.NumberFormat({ fractionDigits: 3 });
      formatter1.format(data, 1);

      var div = document.createElement("div");
      div.className = "tablechart";
      $("#main").append(div);
      var table = new google.visualization.Table(div);
      redrawTable(0);
      table.setSelection([{ row: 0, column: null }]);

      function redrawTable(selectedRow) {
        // Compute relative time using the first row as basis
        var basis = data.getValue(selectedRow, 1);
        for (var rowIndex = 0; rowIndex < data.getNumberOfRows(); rowIndex++)
          data.setValue(rowIndex, 2, basis / data.getValue(rowIndex, 1));

        var formatter = new google.visualization.NumberFormat({ suffix: 'x' });
        formatter.format(data, 2); // Apply formatter to second column

        table.draw(data);
      }

      google.visualization.events.addListener(table, 'select',
        function () {
          var selection = table.getSelection();
          if (selection.length > 0) {
            var item = selection[0];
            if (item.row != null)
              redrawTable(item.row);
          }
        });

    }

    function drawBarChart(type, timeData) {
      var defaultColors = [
        "#3366cc", "#dc3912", "#ff9900", "#109618", "#990099", "#0099c6", "#dd4477",
        "#66aa00", "#b82e2e", "#316395", "#994499", "#22aa99", "#aaaa11", "#6633cc",
        "#e67300", "#8b0707", "#651067", "#329262", "#5574a6", "#3b3eac", "#b77322",
        "#16d620", "#b91383", "#f4359e", "#9c5935", "#a9c413", "#2a778d", "#668d1c",
        "#bea413", "#0c5922", "#743411"
      ];

      // Filter out methods that are too slow.
      var excluded = {
        "ostringstream": true,
        "sprintf": true
      };
      var filtered = [timeData[0]];
      for (var i = 1; i < timeData.length; i++) {
        if (!excluded[timeData[i][0]])
          filtered.push(timeData[i]);
      }

      var data = google.visualization.arrayToDataTable(filtered);
      data.addColumn({ type: "string", role: "style" })
      for (var rowIndex = 0; rowIndex < data.getNumberOfRows(); rowIndex++)
        data.setValue(rowIndex, 2, defaultColors[rowIndex]);

      data.sort([{ column: 1, desc: true }]);
      var options = {
        title: type,
        chartArea: { 'width': '70%', 'height': '70%' },
        width: 800,
        height: 300,
        legend: { position: "none" },
        hAxis: { title: "Time (ns)" }
      };
      var div = document.createElement("div");
      div.className = "chart";
      $(div).data("filename", type + "_time");
      $("#main").append(div);
      var chart = new google.visualization.BarChart(div);

      chart.draw(data, options);
    }

    function drawDigitChart(type, timeDigitData) {
      var data = google.visualization.arrayToDataTable(timeDigitData);

      var options = {
        title: type,
        chartArea: {
          'left': 80,
          'width': '60%',
          'height': '80%'
        },
        hAxis: {
          title: "Digit",
          gridlines: { count: timeDigitData.length - 1 },
          maxAlternation: 1,
          minTextSpacing: 0
        },
        vAxis: {
          title: "Time (ns) in log scale",
          logScale: true,
          minorGridlines: { count: 10 },
          baseline: 0
        },
        width: 800,
        height: 600
      };
      var div = document.createElement("div");
      div.className = "chart";
      $(div).data("filename", type + "_timedigit");
      $("#main").append(div);
      var chart = new google.visualization.LineChart(div);

      chart.draw(data, options);
    }

    // http://jsfiddle.net/P6XXM/
    function sanitize(svg) {
      svg = svg
        .replace(/\<svg/, '<svg xmlns="http://www.w3.org/2000/svg" version="1.1"')
        .replace(/zIndex="[^"]+"/g, '')
        .replace(/isShadow="[^"]+"/g, '')
        .replace(/symbolName="[^"]+"/g, '')
        .replace(/jQuery[0-9]+="[^"]+"/g, '')
        .replace(/isTracker="[^"]+"/g, '')
        .replace(/url\([^#]+#/g, 'url(#')
        .replace('<svg xmlns:xlink="http://www.w3.org/1999/xlink" ', '<svg ')
        .replace(/ href=/g, ' xlink:href=')
        /*.replace(/preserveAspectRatio="none">/g, 'preserveAspectRatio="none"/>')*/
        /* This fails in IE < 8
        .replace(/([0-9]+)\.([0-9]+)/g, function(s1, s2, s3) { // round off to save weight
        return s2 +'.'+ s3[0];
        })*/

        // IE specific
        .replace(/id=([^" >]+)/g, 'id="$1"')
        .replace(/class=([^" ]+)/g, 'class="$1"')
        .replace(/ transform /g, ' ')
        .replace(/:(path|rect)/g, '$1')
        .replace(/<img ([^>]*)>/gi, '<image $1 />')
        .replace(/<\/image>/g, '') // remove closing tags for images as they'll never have any content
        .replace(/<image ([^>]*)([^\/])>/gi, '<image $1$2 />') // closes image tags for firefox
        .replace(/width=(\d+)/g, 'width="$1"')
        .replace(/height=(\d+)/g, 'height="$1"')
        .replace(/hc-svg-href="/g, 'xlink:href="')
        .replace(/style="([^"]+)"/g, function (s) {
          return s.toLowerCase();
        });

      // IE9 beta bugs with innerHTML. Test again with final IE9.
      svg = svg.replace(/(url\(#highcharts-[0-9]+)&quot;/g, '$1')
        .replace(/&quot;/g, "'");
      if (svg.match(/ xmlns="/g).length == 2) {
        svg = svg.replace(/xmlns="[^"]+"/, '');
      }

      return svg;
    }
  </script>
  <style type="text/css">
    @media (min-width: 800px) {
      .container {
        max-width: 800px;
      }
    }

    textarea {
      font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace;
    }

    .tablechart {
      width: 700px;
      margin: auto;
      padding-top: 20px;
      padding-bottom: 20px;
    }

    .chart {
      padding-top: 20px;
      padding-bottom: 20px;
    }

    body {
      padding-top: 70px;
    }
  </style>
</head>

<body>
  <div class="container">
    <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
      <div class="container">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse"
            data-target="#bs-example-navbar-collapse-1">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="https://github.com/fmtlib/dtoa-benchmark"><span
              class="glyphicon glyphicon-home"></span> dtoa-benchmark</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
          <ul class="nav navbar-nav">
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">Configuration <span class="caret"></span></a>
              <ul class="dropdown-menu" role="menu" id="configuration">
              </ul>
            </li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">Section <span class="caret"></span></a>
              <ul class="dropdown-menu" role="menu" id="section">
              </ul>
            </li>
          </ul>
          <p class="navbar-text navbar-right">Developed by <a href="https://github.com/miloyip" class="navbar-link">Milo
              Yip</a></p>
        </div><!-- /.navbar-collapse -->
      </div><!-- /.container-fluid -->
    </nav>
    <div class="page-header">
      <h1 id="title">apple-m1-pro_macos_clang17.0</h1>
    </div>
    <div id="main"></div>
    <h2>Source CSV</h2>
    <textarea id="textInput" class="form-control" rows="5" readonly>
Type,Function,Digit,Time(ns)
randomdigit,asteria,1,69.250410
randomdigit,asteria,2,67.946670
randomdigit,asteria,3,67.428750
randomdigit,asteria,4,68.296670
randomdigit,asteria,5,69.555420
randomdigit,asteria,6,70.195000
randomdigit,asteria,7,71.274170
randomdigit,asteria,8,64.522920
randomdigit,asteria,9,69.636660
randomdigit,asteria,10,70.545830
randomdigit,asteria,11,74.687920
randomdigit,asteria,12,76.738750
randomdigit,asteria,13,76.115840
randomdigit,asteria,14,80.697500
randomdigit,asteria,15,82.817500
randomdigit,asteria,16,84.244580
randomdigit,asteria,17,86.927920
randomdigit,double-conversion,1,60.360000
randomdigit,double-conversion,2,74.675420
randomdigit,double-conversion,3,78.111670
randomdigit,double-conversion,4,80.115420
randomdigit,double-conversion,5,82.345420
randomdigit,double-conversion,6,83.522500
randomdigit,double-conversion,7,85.800830
randomdigit,double-conversion,8,86.891670
randomdigit,double-conversion,9,86.057920
randomdigit,double-conversion,10,85.067090
randomdigit,double-conversion,11,84.693330
randomdigit,double-conversion,12,87.377910
randomdigit,double-conversion,13,88.782920
randomdigit,double-conversion,14,91.473330
randomdigit,double-conversion,15,94.576250
randomdigit,double-conversion,16,97.556670
randomdigit,double-conversion,17,103.884160
randomdigit,dragonbox,1,18.722920
randomdigit,dragonbox,2,20.464160
randomdigit,dragonbox,3,20.199170
randomdigit,dragonbox,4,20.351660
randomdigit,dragonbox,5,19.847080
randomdigit,dragonbox,6,20.816660
randomdigit,dragonbox,7,20.490000
randomdigit,dragonbox,8,21.324160
randomdigit,dragonbox,9,20.391250
randomdigit,dragonbox,10,21.347910
randomdigit,dragonbox,11,20.898330
randomdigit,dragonbox,12,21.532080
randomdigit,dragonbox,13,21.168330
randomdigit,dragonbox,14,22.162500
randomdigit,dragonbox,15,21.435000
randomdigit,dragonbox,16,22.228750
randomdigit,dragonbox,17,24.767920
randomdigit,fmt,1,19.627080
randomdigit,fmt,2,22.545420
randomdigit,fmt,3,20.721250
randomdigit,fmt,4,21.975000
randomdigit,fmt,5,20.181670
randomdigit,fmt,6,21.600420
randomdigit,fmt,7,20.036670
randomdigit,fmt,8,22.039170
randomdigit,fmt,9,23.210000
randomdigit,fmt,10,26.255000
randomdigit,fmt,11,22.779170
randomdigit,fmt,12,25.066250
randomdigit,fmt,13,22.742910
randomdigit,fmt,14,24.317920
randomdigit,fmt,15,22.408340
randomdigit,fmt,16,24.127910
randomdigit,fmt,17,28.584170
randomdigit,null,1,0.931250
randomdigit,null,2,0.930840
randomdigit,null,3,0.930000
randomdigit,null,4,0.930410
randomdigit,null,5,0.930410
randomdigit,null,6,0.930000
randomdigit,null,7,0.929590
randomdigit,null,8,0.930830
randomdigit,null,9,0.929590
randomdigit,null,10,0.929580
randomdigit,null,11,0.930410
randomdigit,null,12,0.930000
randomdigit,null,13,0.929580
randomdigit,null,14,0.931670
randomdigit,null,15,0.973750
randomdigit,null,16,0.930410
randomdigit,null,17,0.929580
randomdigit,ostringstream,1,811.142080
randomdigit,ostringstream,2,827.908340
randomdigit,ostringstream,3,858.485000
randomdigit,ostringstream,4,859.407090
randomdigit,ostringstream,5,902.061250
randomdigit,ostringstream,6,881.734170
randomdigit,ostringstream,7,886.152920
randomdigit,ostringstream,8,898.384580
randomdigit,ostringstream,9,904.845420
randomdigit,ostringstream,10,966.136660
randomdigit,ostringstream,11,927.495000
randomdigit,ostringstream,12,932.687920
randomdigit,ostringstream,13,944.626670
randomdigit,ostringstream,14,955.108340
randomdigit,ostringstream,15,960.327500
randomdigit,ostringstream,16,965.793750
randomdigit,ostringstream,17,962.216250
randomdigit,ryu,1,46.244170
randomdigit,ryu,2,47.152920
randomdigit,ryu,3,46.234170
randomdigit,ryu,4,44.975830
randomdigit,ryu,5,42.915410
randomdigit,ryu,6,42.825000
randomdigit,ryu,7,38.866250
randomdigit,ryu,8,39.352500
randomdigit,ryu,9,37.428330
randomdigit,ryu,10,38.151250
randomdigit,ryu,11,33.651250
randomdigit,ryu,12,32.694580
randomdigit,ryu,13,32.617090
randomdigit,ryu,14,30.653330
randomdigit,ryu,15,29.649580
randomdigit,ryu,16,29.111660
randomdigit,ryu,17,28.235840
randomdigit,schubfach,1,20.714590
randomdigit,schubfach,2,24.667500
randomdigit,schubfach,3,24.692500
randomdigit,schubfach,4,24.677080
randomdigit,schubfach,5,23.574170
randomdigit,schubfach,6,23.624170
randomdigit,schubfach,7,22.629160
randomdigit,schubfach,8,22.870410
randomdigit,schubfach,9,22.723330
randomdigit,schubfach,10,25.272500
randomdigit,schubfach,11,26.542500
randomdigit,schubfach,12,26.105410
randomdigit,schubfach,13,26.645410
randomdigit,schubfach,14,25.617080
randomdigit,schubfach,15,26.810420
randomdigit,schubfach,16,27.704580
randomdigit,schubfach,17,34.422500
randomdigit,sprintf,1,666.472090
randomdigit,sprintf,2,686.137920
randomdigit,sprintf,3,701.867500
randomdigit,sprintf,4,716.856670
randomdigit,sprintf,5,727.165000
randomdigit,sprintf,6,755.905420
randomdigit,sprintf,7,756.024170
randomdigit,sprintf,8,761.893750
randomdigit,sprintf,9,757.892910
randomdigit,sprintf,10,769.645000
randomdigit,sprintf,11,783.231250
randomdigit,sprintf,12,788.040420
randomdigit,sprintf,13,798.765000
randomdigit,sprintf,14,808.132080
randomdigit,sprintf,15,811.698750
randomdigit,sprintf,16,819.222500
randomdigit,sprintf,17,844.627500
randomdigit,to_chars,1,55.688330
randomdigit,to_chars,2,56.589170
randomdigit,to_chars,3,53.414160
randomdigit,to_chars,4,52.217500
randomdigit,to_chars,5,50.237500
randomdigit,to_chars,6,49.625840
randomdigit,to_chars,7,47.589170
randomdigit,to_chars,8,45.171250
randomdigit,to_chars,9,44.564160
randomdigit,to_chars,10,45.710410
randomdigit,to_chars,11,42.492500
randomdigit,to_chars,12,40.747910
randomdigit,to_chars,13,39.090000
randomdigit,to_chars,14,38.275410
randomdigit,to_chars,15,36.926670
randomdigit,to_chars,16,35.778330
randomdigit,to_chars,17,37.330840
randomdigit,xjb64,1,11.192500
randomdigit,xjb64,2,11.152500
randomdigit,xjb64,3,11.165420
randomdigit,xjb64,4,11.325420
randomdigit,xjb64,5,11.140830
randomdigit,xjb64,6,10.811250
randomdigit,xjb64,7,10.988330
randomdigit,xjb64,8,11.218750
randomdigit,xjb64,9,11.172920
randomdigit,xjb64,10,11.210840
randomdigit,xjb64,11,11.218340
randomdigit,xjb64,12,11.186670
randomdigit,xjb64,13,11.174160
randomdigit,xjb64,14,11.205830
randomdigit,xjb64,15,11.154170
randomdigit,xjb64,16,11.411670
randomdigit,xjb64,17,11.315000
randomdigit,yy,1,12.897920
randomdigit,yy,2,12.924590
randomdigit,yy,3,12.940000
randomdigit,yy,4,21.787080
randomdigit,yy,5,15.647920
randomdigit,yy,6,15.259170
randomdigit,yy,7,13.932920
randomdigit,yy,8,13.740410
randomdigit,yy,9,15.965420
randomdigit,yy,10,15.931670
randomdigit,yy,11,14.917500
randomdigit,yy,12,14.822080
randomdigit,yy,13,17.472920
randomdigit,yy,14,17.114160
randomdigit,yy,15,15.941670
randomdigit,yy,16,15.909580
randomdigit,yy,17,15.847920
randomdigit,zmij,1,10.601660
randomdigit,zmij,2,10.615410
randomdigit,zmij,3,13.074580
randomdigit,zmij,4,11.067080
randomdigit,zmij,5,10.647920
randomdigit,zmij,6,10.652500
randomdigit,zmij,7,10.294170
randomdigit,zmij,8,10.561660
randomdigit,zmij,9,10.775420
randomdigit,zmij,10,10.633330
randomdigit,zmij,11,10.632500
randomdigit,zmij,12,10.714580
randomdigit,zmij,13,10.428330
randomdigit,zmij,14,10.566250
randomdigit,zmij,15,10.546660
randomdigit,zmij,16,10.752080
randomdigit,zmij,17,10.575420
</textarea>
  </div>
  <div class="row" id="downloadDD" style="display: none">
    <div class="btn-group pull-right">
      <button class="btn dropdown-toggle" data-toggle="dropdown"><span
          class="glyphicon glyphicon-picture"></span></button>
      <ul class="dropdown-menu">
        <li><a tabindex="-1" href="#" dltype="image/jpeg">JPEG</a></li>
        <li><a tabindex="-1" href="#" dltype="image/png">PNG</a></li>
        <li><a tabindex="-1" href="#" dltype="application/pdf">PDF</a></li>
        <li><a tabindex="-1" href="#" dltype="image/svg+xml">SVG</a></li>
      </ul>
    </div>
  </div>
  <form method="post" action="http://export.highcharts.com/" id="imageGetForm">
    <input type="hidden" name="filename" id="imageFilename" value="" />
    <input type="hidden" name="type" id="imageGetFormTYPE" value="" />
    <input type="hidden" name="width" value="900" />
    <input type="hidden" name="svg" value="" id="imageGetFormSVG" />
  </form>
  </div>
</body>

</html>