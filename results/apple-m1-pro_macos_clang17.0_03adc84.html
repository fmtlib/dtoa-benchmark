<!--
Copyright (C) 2014 Milo Yip

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.
-->
<html>

<head>
  <script src="https://code.jquery.com/jquery-1.8.2.js"></script>
  <script type="text/javascript" src="https://www.google.com/jsapi"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-csv/0.8.12/jquery.csv.js"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
  <script>
    google.load("visualization", "1", { packages: ["corechart", "table"] });
    google.setOnLoadCallback(drawChart);
    function drawChart() {
      var csv = $('#textInput').val();
      var data = $.csv.toArrays(csv, {
        onParseValue: $.csv.hooks.castToScalar
      });

      // Convert data for bar chart (summing all digits)
      var timeData = {};	// type -> table
      var funcRowMap;
      var maxDigit = 0;

      for (var i = 1; i < data.length; i++) {
        var type = data[i][0];
        var func = data[i][1];
        var digit = data[i][2];
        var time = data[i][3];
        if (timeData[type] == null) {
          timeData[type] = [["Function", "Time (ns)"/*, { role: "style" }*/]];
          if (digit != 0)
            funcRowMap = {};
        }

        var table = timeData[type];

        if (digit != 0) {
          if (funcRowMap[func] == null)
            funcRowMap[func] = table.push([func, 0]) - 1;

          table[funcRowMap[func]][1] += time;
        }
        else
          table.push([func, time]);

        maxDigit = Math.max(maxDigit, digit);
      }

      // Compute average
      for (var type in timeData) {
        var table = timeData[type];
        for (var i = 1; i < table.length; i++)
          table[i][1] /= maxDigit;
      }

      // Convert data for drawing line chart per random digit
      var timeDigitData = {}; // type -> table
      var funcColumnMap;

      for (var i = 1; i < data.length; i++) {
        var type = data[i][0];
        var func = data[i][1];
        var digit = data[i][2];
        var time = data[i][3];

        if (digit == 0)
          continue;

        if (timeDigitData[type] == null) {
          timeDigitData[type] = [["Digit"]];
          funcColumnMap = {};
        }

        var table = timeDigitData[type];

        if (funcColumnMap[func] == null)
          funcColumnMap[func] = table[0].push(func) - 1;

        var row;
        for (row = 1; row < table.length; row++)
          if (table[row][0] == digit)
            break;

        if (row == table.length)
          table.push([digit]);

        table[row][funcColumnMap[func]] = time;
      }

      for (var type in timeData) {
        $("#main").append(
          $("<a>", { name: type }),
          $("<h2>", { style: "padding-top: 70px; margin-top: -70px;" }).append(type)
        );

        $("#section").append($("<li>").append($("<a>", { href: "#" + type }).append(type)));

        drawTable(type, timeData[type]);
        drawBarChart(type, timeData[type]);
        if (timeDigitData[type] != null)
          drawDigitChart(type, timeDigitData[type]);
      }

      $(".chart").each(function () {
        var chart = $(this);
        var d = $("#downloadDD").clone().css("display", "");
        $('li a', d).each(function () {
          $(this).click(function () {
            var svg = chart[0].getElementsByTagName('svg')[0].parentNode.innerHTML;
            svg = sanitize(svg);
            $('#imageFilename').val($("#title").html() + "_" + chart.data("filename"));
            $('#imageGetFormTYPE').val($(this).attr('dltype'));
            $('#imageGetFormSVG').val(svg);
            $('#imageGetForm').submit();
          });
        });
        $(this).after(d);
      });

      // Add configurations
      var thisConfig = "apple-m1-pro_macos_clang17.0_03adc84";
      var configurations = [];

      for (var i in configurations) {
        var c = configurations[i];
        $("#configuration").append($("<li>", { class: (c == thisConfig ? "active" : "") }).append($("<a>", { href: c + ".html" }).append(c)));
      }
    }

    function drawTable(type, timeData) {
      var data = google.visualization.arrayToDataTable(timeData);
      data.addColumn('number', 'Speedup');
      data.sort([{ column: 1, desc: true }]);
      var formatter1 = new google.visualization.NumberFormat({ fractionDigits: 3 });
      formatter1.format(data, 1);

      var div = document.createElement("div");
      div.className = "tablechart";
      $("#main").append(div);
      var table = new google.visualization.Table(div);
      redrawTable(0);
      table.setSelection([{ row: 0, column: null }]);

      function redrawTable(selectedRow) {
        // Compute relative time using the first row as basis
        var basis = data.getValue(selectedRow, 1);
        for (var rowIndex = 0; rowIndex < data.getNumberOfRows(); rowIndex++)
          data.setValue(rowIndex, 2, basis / data.getValue(rowIndex, 1));

        var formatter = new google.visualization.NumberFormat({ suffix: 'x' });
        formatter.format(data, 2); // Apply formatter to second column

        table.draw(data);
      }

      google.visualization.events.addListener(table, 'select',
        function () {
          var selection = table.getSelection();
          if (selection.length > 0) {
            var item = selection[0];
            if (item.row != null)
              redrawTable(item.row);
          }
        });

    }

    function drawBarChart(type, timeData) {
      var defaultColors = [
        "#3366cc", "#dc3912", "#ff9900", "#109618", "#990099", "#0099c6", "#dd4477",
        "#66aa00", "#b82e2e", "#316395", "#994499", "#22aa99", "#aaaa11", "#6633cc",
        "#e67300", "#8b0707", "#651067", "#329262", "#5574a6", "#3b3eac", "#b77322",
        "#16d620", "#b91383", "#f4359e", "#9c5935", "#a9c413", "#2a778d", "#668d1c",
        "#bea413", "#0c5922", "#743411"
      ];

      // Filter out methods that are too slow.
      var excluded = {
        "ostringstream": true,
        "sprintf": true
      };
      var filtered = [timeData[0]];
      for (var i = 1; i < timeData.length; i++) {
        if (!excluded[timeData[i][0]])
          filtered.push(timeData[i]);
      }

      var data = google.visualization.arrayToDataTable(filtered);
      data.addColumn({ type: "string", role: "style" })
      for (var rowIndex = 0; rowIndex < data.getNumberOfRows(); rowIndex++)
        data.setValue(rowIndex, 2, defaultColors[rowIndex]);

      data.sort([{ column: 1, desc: true }]);
      var options = {
        title: type,
        chartArea: { 'width': '70%', 'height': '70%' },
        width: 800,
        height: 300,
        legend: { position: "none" },
        hAxis: { title: "Time (ns)" }
      };
      var div = document.createElement("div");
      div.className = "chart";
      $(div).data("filename", type + "_time");
      $("#main").append(div);
      var chart = new google.visualization.BarChart(div);

      chart.draw(data, options);
    }

    function drawDigitChart(type, timeDigitData) {
      var data = google.visualization.arrayToDataTable(timeDigitData);

      var options = {
        title: type,
        chartArea: {
          'left': 80,
          'width': '60%',
          'height': '80%'
        },
        hAxis: {
          title: "Digit",
          gridlines: { count: timeDigitData.length - 1 },
          maxAlternation: 1,
          minTextSpacing: 0
        },
        vAxis: {
          title: "Time (ns) in log scale",
          logScale: true,
          minorGridlines: { count: 10 },
          baseline: 0
        },
        width: 800,
        height: 600
      };
      var div = document.createElement("div");
      div.className = "chart";
      $(div).data("filename", type + "_timedigit");
      $("#main").append(div);
      var chart = new google.visualization.LineChart(div);

      chart.draw(data, options);
    }

    // http://jsfiddle.net/P6XXM/
    function sanitize(svg) {
      svg = svg
        .replace(/\<svg/, '<svg xmlns="http://www.w3.org/2000/svg" version="1.1"')
        .replace(/zIndex="[^"]+"/g, '')
        .replace(/isShadow="[^"]+"/g, '')
        .replace(/symbolName="[^"]+"/g, '')
        .replace(/jQuery[0-9]+="[^"]+"/g, '')
        .replace(/isTracker="[^"]+"/g, '')
        .replace(/url\([^#]+#/g, 'url(#')
        .replace('<svg xmlns:xlink="http://www.w3.org/1999/xlink" ', '<svg ')
        .replace(/ href=/g, ' xlink:href=')
        /*.replace(/preserveAspectRatio="none">/g, 'preserveAspectRatio="none"/>')*/
        /* This fails in IE < 8
        .replace(/([0-9]+)\.([0-9]+)/g, function(s1, s2, s3) { // round off to save weight
        return s2 +'.'+ s3[0];
        })*/

        // IE specific
        .replace(/id=([^" >]+)/g, 'id="$1"')
        .replace(/class=([^" ]+)/g, 'class="$1"')
        .replace(/ transform /g, ' ')
        .replace(/:(path|rect)/g, '$1')
        .replace(/<img ([^>]*)>/gi, '<image $1 />')
        .replace(/<\/image>/g, '') // remove closing tags for images as they'll never have any content
        .replace(/<image ([^>]*)([^\/])>/gi, '<image $1$2 />') // closes image tags for firefox
        .replace(/width=(\d+)/g, 'width="$1"')
        .replace(/height=(\d+)/g, 'height="$1"')
        .replace(/hc-svg-href="/g, 'xlink:href="')
        .replace(/style="([^"]+)"/g, function (s) {
          return s.toLowerCase();
        });

      // IE9 beta bugs with innerHTML. Test again with final IE9.
      svg = svg.replace(/(url\(#highcharts-[0-9]+)&quot;/g, '$1')
        .replace(/&quot;/g, "'");
      if (svg.match(/ xmlns="/g).length == 2) {
        svg = svg.replace(/xmlns="[^"]+"/, '');
      }

      return svg;
    }
  </script>
  <style type="text/css">
    @media (min-width: 800px) {
      .container {
        max-width: 800px;
      }
    }

    textarea {
      font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace;
    }

    .tablechart {
      width: 700px;
      margin: auto;
      padding-top: 20px;
      padding-bottom: 20px;
    }

    .chart {
      padding-top: 20px;
      padding-bottom: 20px;
    }

    body {
      padding-top: 70px;
    }
  </style>
</head>

<body>
  <div class="container">
    <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
      <div class="container">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse"
            data-target="#bs-example-navbar-collapse-1">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="https://github.com/fmtlib/dtoa-benchmark"><span
              class="glyphicon glyphicon-home"></span> dtoa-benchmark</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
          <ul class="nav navbar-nav">
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">Configuration <span class="caret"></span></a>
              <ul class="dropdown-menu" role="menu" id="configuration">
              </ul>
            </li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">Section <span class="caret"></span></a>
              <ul class="dropdown-menu" role="menu" id="section">
              </ul>
            </li>
          </ul>
          <p class="navbar-text navbar-right">Developed by <a href="https://github.com/miloyip" class="navbar-link">Milo
              Yip</a></p>
        </div><!-- /.navbar-collapse -->
      </div><!-- /.container-fluid -->
    </nav>
    <div class="page-header">
      <h1 id="title">apple-m1-pro_macos_clang17.0_03adc84</h1>
    </div>
    <div id="main"></div>
    <h2>Source CSV</h2>
    <textarea id="textInput" class="form-control" rows="5" readonly>
Type,Function,Digit,Time(ns)
randomdigit,double-conversion,1,58.874167
randomdigit,double-conversion,2,71.269000
randomdigit,double-conversion,3,75.902208
randomdigit,double-conversion,4,76.756250
randomdigit,double-conversion,5,80.131375
randomdigit,double-conversion,6,81.708667
randomdigit,double-conversion,7,84.353167
randomdigit,double-conversion,8,86.812625
randomdigit,double-conversion,9,85.519167
randomdigit,double-conversion,10,82.791250
randomdigit,double-conversion,11,82.178833
randomdigit,double-conversion,12,84.433792
randomdigit,double-conversion,13,86.834541
randomdigit,double-conversion,14,89.812834
randomdigit,double-conversion,15,93.643791
randomdigit,double-conversion,16,94.844083
randomdigit,double-conversion,17,100.772083
randomdigit,dragonbox,1,18.553292
randomdigit,dragonbox,2,19.813458
randomdigit,dragonbox,3,19.615834
randomdigit,dragonbox,4,20.442500
randomdigit,dragonbox,5,19.742292
randomdigit,dragonbox,6,20.617208
randomdigit,dragonbox,7,19.975000
randomdigit,dragonbox,8,20.777000
randomdigit,dragonbox,9,19.997458
randomdigit,dragonbox,10,20.627459
randomdigit,dragonbox,11,20.285458
randomdigit,dragonbox,12,21.095166
randomdigit,dragonbox,13,20.386500
randomdigit,dragonbox,14,21.321042
randomdigit,dragonbox,15,20.651208
randomdigit,dragonbox,16,21.437375
randomdigit,dragonbox,17,23.714042
randomdigit,fmt,1,18.789541
randomdigit,fmt,2,22.256917
randomdigit,fmt,3,20.352541
randomdigit,fmt,4,21.373375
randomdigit,fmt,5,19.563250
randomdigit,fmt,6,21.112583
randomdigit,fmt,7,19.596208
randomdigit,fmt,8,21.727625
randomdigit,fmt,9,22.839375
randomdigit,fmt,10,24.752875
randomdigit,fmt,11,22.747625
randomdigit,fmt,12,24.331166
randomdigit,fmt,13,22.036875
randomdigit,fmt,14,23.594500
randomdigit,fmt,15,21.651000
randomdigit,fmt,16,23.329125
randomdigit,fmt,17,27.753458
randomdigit,null,1,0.948333
randomdigit,null,2,0.958958
randomdigit,null,3,0.931917
randomdigit,null,4,0.958125
randomdigit,null,5,0.949208
randomdigit,null,6,0.930667
randomdigit,null,7,0.958625
randomdigit,null,8,0.959459
randomdigit,null,9,0.930083
randomdigit,null,10,0.929750
randomdigit,null,11,0.958708
randomdigit,null,12,0.959000
randomdigit,null,13,0.958750
randomdigit,null,14,0.930916
randomdigit,null,15,0.930167
randomdigit,null,16,0.959542
randomdigit,null,17,0.930541
randomdigit,ostringstream,1,786.436875
randomdigit,ostringstream,2,802.540542
randomdigit,ostringstream,3,816.357625
randomdigit,ostringstream,4,825.881875
randomdigit,ostringstream,5,837.854167
randomdigit,ostringstream,6,850.480750
randomdigit,ostringstream,7,859.341042
randomdigit,ostringstream,8,868.965917
randomdigit,ostringstream,9,873.233542
randomdigit,ostringstream,10,879.086875
randomdigit,ostringstream,11,889.161375
randomdigit,ostringstream,12,900.080375
randomdigit,ostringstream,13,912.978291
randomdigit,ostringstream,14,921.507625
randomdigit,ostringstream,15,925.333250
randomdigit,ostringstream,16,935.133209
randomdigit,ostringstream,17,929.960042
randomdigit,ryu,1,45.647375
randomdigit,ryu,2,46.069291
randomdigit,ryu,3,45.452667
randomdigit,ryu,4,44.101708
randomdigit,ryu,5,42.586417
randomdigit,ryu,6,41.744750
randomdigit,ryu,7,38.326208
randomdigit,ryu,8,37.038583
randomdigit,ryu,9,35.592792
randomdigit,ryu,10,36.460417
randomdigit,ryu,11,33.548334
randomdigit,ryu,12,32.544333
randomdigit,ryu,13,31.378792
randomdigit,ryu,14,30.068125
randomdigit,ryu,15,28.936709
randomdigit,ryu,16,28.174875
randomdigit,ryu,17,28.078666
randomdigit,schubfach,1,20.517291
randomdigit,schubfach,2,24.113000
randomdigit,schubfach,3,23.600458
randomdigit,schubfach,4,23.419292
randomdigit,schubfach,5,23.092000
randomdigit,schubfach,6,22.942917
randomdigit,schubfach,7,22.645000
randomdigit,schubfach,8,22.468167
randomdigit,schubfach,9,22.339500
randomdigit,schubfach,10,24.546875
randomdigit,schubfach,11,26.241041
randomdigit,schubfach,12,26.051917
randomdigit,schubfach,13,25.901709
randomdigit,schubfach,14,25.564167
randomdigit,schubfach,15,25.456958
randomdigit,schubfach,16,28.070209
randomdigit,schubfach,17,33.294125
randomdigit,sprintf,1,648.645958
randomdigit,sprintf,2,668.353875
randomdigit,sprintf,3,682.904625
randomdigit,sprintf,4,693.363167
randomdigit,sprintf,5,704.459750
randomdigit,sprintf,6,716.030750
randomdigit,sprintf,7,723.020542
randomdigit,sprintf,8,732.057625
randomdigit,sprintf,9,737.337709
randomdigit,sprintf,10,746.307209
randomdigit,sprintf,11,754.567541
randomdigit,sprintf,12,764.143542
randomdigit,sprintf,13,777.701917
randomdigit,sprintf,14,786.073292
randomdigit,sprintf,15,791.278333
randomdigit,sprintf,16,791.408333
randomdigit,sprintf,17,782.303209
randomdigit,to_chars,1,52.291791
randomdigit,to_chars,2,53.018625
randomdigit,to_chars,3,50.325167
randomdigit,to_chars,4,48.576542
randomdigit,to_chars,5,47.094875
randomdigit,to_chars,6,47.197666
randomdigit,to_chars,7,45.466125
randomdigit,to_chars,8,43.065916
randomdigit,to_chars,9,41.859625
randomdigit,to_chars,10,43.011917
randomdigit,to_chars,11,39.597708
randomdigit,to_chars,12,38.179917
randomdigit,to_chars,13,37.875041
randomdigit,to_chars,14,36.135667
randomdigit,to_chars,15,35.091083
randomdigit,to_chars,16,34.038959
randomdigit,to_chars,17,34.907083
randomdigit,xjb64,1,10.503834
randomdigit,xjb64,2,10.520916
randomdigit,xjb64,3,10.520208
randomdigit,xjb64,4,10.538583
randomdigit,xjb64,5,10.523500
randomdigit,xjb64,6,10.497041
randomdigit,xjb64,7,10.534042
randomdigit,xjb64,8,10.540625
randomdigit,xjb64,9,10.622667
randomdigit,xjb64,10,10.563792
randomdigit,xjb64,11,10.552042
randomdigit,xjb64,12,10.611500
randomdigit,xjb64,13,10.549708
randomdigit,xjb64,14,10.511625
randomdigit,xjb64,15,10.540375
randomdigit,xjb64,16,10.545500
randomdigit,xjb64,17,10.539000
randomdigit,yy,1,12.033417
randomdigit,yy,2,12.082708
randomdigit,yy,3,12.064833
randomdigit,yy,4,12.050375
randomdigit,yy,5,14.704334
randomdigit,yy,6,14.100750
randomdigit,yy,7,13.007584
randomdigit,yy,8,12.916167
randomdigit,yy,9,15.128709
randomdigit,yy,10,14.950292
randomdigit,yy,11,14.011209
randomdigit,yy,12,13.986208
randomdigit,yy,13,16.406750
randomdigit,yy,14,15.950541
randomdigit,yy,15,14.921875
randomdigit,yy,16,14.891083
randomdigit,yy,17,14.898291
randomdigit,zmij,1,8.683583
randomdigit,zmij,2,8.638250
randomdigit,zmij,3,8.658541
randomdigit,zmij,4,8.636125
randomdigit,zmij,5,8.641042
randomdigit,zmij,6,8.646292
randomdigit,zmij,7,8.657583
randomdigit,zmij,8,8.656791
randomdigit,zmij,9,8.647625
randomdigit,zmij,10,8.623125
randomdigit,zmij,11,8.627250
randomdigit,zmij,12,8.661583
randomdigit,zmij,13,8.650500
randomdigit,zmij,14,8.658333
randomdigit,zmij,15,8.659333
randomdigit,zmij,16,8.816958
randomdigit,zmij,17,8.671541
</textarea>
  </div>
  <div class="row" id="downloadDD" style="display: none">
    <div class="btn-group pull-right">
      <button class="btn dropdown-toggle" data-toggle="dropdown"><span
          class="glyphicon glyphicon-picture"></span></button>
      <ul class="dropdown-menu">
        <li><a tabindex="-1" href="#" dltype="image/jpeg">JPEG</a></li>
        <li><a tabindex="-1" href="#" dltype="image/png">PNG</a></li>
        <li><a tabindex="-1" href="#" dltype="application/pdf">PDF</a></li>
        <li><a tabindex="-1" href="#" dltype="image/svg+xml">SVG</a></li>
      </ul>
    </div>
  </div>
  <form method="post" action="http://export.highcharts.com/" id="imageGetForm">
    <input type="hidden" name="filename" id="imageFilename" value="" />
    <input type="hidden" name="type" id="imageGetFormTYPE" value="" />
    <input type="hidden" name="width" value="900" />
    <input type="hidden" name="svg" value="" id="imageGetFormSVG" />
  </form>
  </div>
</body>

</html>