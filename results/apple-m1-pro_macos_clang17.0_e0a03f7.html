<!--
Copyright (C) 2014 Milo Yip

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.
-->
<html>

<head>
  <script src="https://code.jquery.com/jquery-1.8.2.js"></script>
  <script type="text/javascript" src="https://www.google.com/jsapi"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-csv/0.8.12/jquery.csv.js"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
  <script>
    google.load("visualization", "1", { packages: ["corechart", "table"] });
    google.setOnLoadCallback(drawChart);
    function drawChart() {
      var csv = $('#textInput').val();
      var data = $.csv.toArrays(csv, {
        onParseValue: $.csv.hooks.castToScalar
      });

      // Convert data for bar chart (summing all digits)
      var timeData = {};	// type -> table
      var funcRowMap;
      var maxDigit = 0;

      for (var i = 1; i < data.length; i++) {
        var type = data[i][0];
        var func = data[i][1];
        var digit = data[i][2];
        var time = data[i][3];
        if (timeData[type] == null) {
          timeData[type] = [["Function", "Time (ns)"/*, { role: "style" }*/]];
          if (digit != 0)
            funcRowMap = {};
        }

        var table = timeData[type];

        if (digit != 0) {
          if (funcRowMap[func] == null)
            funcRowMap[func] = table.push([func, 0]) - 1;

          table[funcRowMap[func]][1] += time;
        }
        else
          table.push([func, time]);

        maxDigit = Math.max(maxDigit, digit);
      }

      // Compute average
      for (var type in timeData) {
        var table = timeData[type];
        for (var i = 1; i < table.length; i++)
          table[i][1] /= maxDigit;
      }

      // Convert data for drawing line chart per random digit
      var timeDigitData = {}; // type -> table
      var funcColumnMap;

      for (var i = 1; i < data.length; i++) {
        var type = data[i][0];
        var func = data[i][1];
        var digit = data[i][2];
        var time = data[i][3];

        if (digit == 0)
          continue;

        if (timeDigitData[type] == null) {
          timeDigitData[type] = [["Digit"]];
          funcColumnMap = {};
        }

        var table = timeDigitData[type];

        if (funcColumnMap[func] == null)
          funcColumnMap[func] = table[0].push(func) - 1;

        var row;
        for (row = 1; row < table.length; row++)
          if (table[row][0] == digit)
            break;

        if (row == table.length)
          table.push([digit]);

        table[row][funcColumnMap[func]] = time;
      }

      for (var type in timeData) {
        $("#main").append(
          $("<a>", { name: type }),
          $("<h2>", { style: "padding-top: 70px; margin-top: -70px;" }).append(type)
        );

        $("#section").append($("<li>").append($("<a>", { href: "#" + type }).append(type)));

        drawTable(type, timeData[type]);
        drawBarChart(type, timeData[type]);
        if (timeDigitData[type] != null)
          drawDigitChart(type, timeDigitData[type]);
      }

      $(".chart").each(function () {
        var chart = $(this);
        var d = $("#downloadDD").clone().css("display", "");
        $('li a', d).each(function () {
          $(this).click(function () {
            var svg = chart[0].getElementsByTagName('svg')[0].parentNode.innerHTML;
            svg = sanitize(svg);
            $('#imageFilename').val($("#title").html() + "_" + chart.data("filename"));
            $('#imageGetFormTYPE').val($(this).attr('dltype'));
            $('#imageGetFormSVG').val(svg);
            $('#imageGetForm').submit();
          });
        });
        $(this).after(d);
      });

      // Add configurations
      var thisConfig = "apple-m1-pro_macos_clang17.0_e0a03f7";
      var configurations = [];

      for (var i in configurations) {
        var c = configurations[i];
        $("#configuration").append($("<li>", { class: (c == thisConfig ? "active" : "") }).append($("<a>", { href: c + ".html" }).append(c)));
      }
    }

    function drawTable(type, timeData) {
      var data = google.visualization.arrayToDataTable(timeData);
      data.addColumn('number', 'Speedup');
      data.sort([{ column: 1, desc: true }]);
      var formatter1 = new google.visualization.NumberFormat({ fractionDigits: 3 });
      formatter1.format(data, 1);

      var div = document.createElement("div");
      div.className = "tablechart";
      $("#main").append(div);
      var table = new google.visualization.Table(div);
      redrawTable(0);
      table.setSelection([{ row: 0, column: null }]);

      function redrawTable(selectedRow) {
        // Compute relative time using the first row as basis
        var basis = data.getValue(selectedRow, 1);
        for (var rowIndex = 0; rowIndex < data.getNumberOfRows(); rowIndex++)
          data.setValue(rowIndex, 2, basis / data.getValue(rowIndex, 1));

        var formatter = new google.visualization.NumberFormat({ suffix: 'x' });
        formatter.format(data, 2); // Apply formatter to second column

        table.draw(data);
      }

      google.visualization.events.addListener(table, 'select',
        function () {
          var selection = table.getSelection();
          if (selection.length > 0) {
            var item = selection[0];
            if (item.row != null)
              redrawTable(item.row);
          }
        });

    }

    function drawBarChart(type, timeData) {
      var defaultColors = [
        "#3366cc", "#dc3912", "#ff9900", "#109618", "#990099", "#0099c6", "#dd4477",
        "#66aa00", "#b82e2e", "#316395", "#994499", "#22aa99", "#aaaa11", "#6633cc",
        "#e67300", "#8b0707", "#651067", "#329262", "#5574a6", "#3b3eac", "#b77322",
        "#16d620", "#b91383", "#f4359e", "#9c5935", "#a9c413", "#2a778d", "#668d1c",
        "#bea413", "#0c5922", "#743411"
      ];

      // Filter out methods that are too slow.
      var excluded = {
        "ostringstream": true,
        "sprintf": true
      };
      var filtered = [timeData[0]];
      for (var i = 1; i < timeData.length; i++) {
        if (!excluded[timeData[i][0]])
          filtered.push(timeData[i]);
      }

      var data = google.visualization.arrayToDataTable(filtered);
      data.addColumn({ type: "string", role: "style" })
      for (var rowIndex = 0; rowIndex < data.getNumberOfRows(); rowIndex++)
        data.setValue(rowIndex, 2, defaultColors[rowIndex]);

      data.sort([{ column: 1, desc: true }]);
      var options = {
        title: type,
        chartArea: { 'width': '70%', 'height': '70%' },
        width: 800,
        height: 300,
        legend: { position: "none" },
        hAxis: { title: "Time (ns)" }
      };
      var div = document.createElement("div");
      div.className = "chart";
      $(div).data("filename", type + "_time");
      $("#main").append(div);
      var chart = new google.visualization.BarChart(div);

      chart.draw(data, options);
    }

    function drawDigitChart(type, timeDigitData) {
      var data = google.visualization.arrayToDataTable(timeDigitData);

      var options = {
        title: type,
        chartArea: {
          'left': 80,
          'width': '60%',
          'height': '80%'
        },
        hAxis: {
          title: "Digit",
          gridlines: { count: timeDigitData.length - 1 },
          maxAlternation: 1,
          minTextSpacing: 0
        },
        vAxis: {
          title: "Time (ns) in log scale",
          logScale: true,
          minorGridlines: { count: 10 },
          baseline: 0
        },
        width: 800,
        height: 600
      };
      var div = document.createElement("div");
      div.className = "chart";
      $(div).data("filename", type + "_timedigit");
      $("#main").append(div);
      var chart = new google.visualization.LineChart(div);

      chart.draw(data, options);
    }

    // http://jsfiddle.net/P6XXM/
    function sanitize(svg) {
      svg = svg
        .replace(/\<svg/, '<svg xmlns="http://www.w3.org/2000/svg" version="1.1"')
        .replace(/zIndex="[^"]+"/g, '')
        .replace(/isShadow="[^"]+"/g, '')
        .replace(/symbolName="[^"]+"/g, '')
        .replace(/jQuery[0-9]+="[^"]+"/g, '')
        .replace(/isTracker="[^"]+"/g, '')
        .replace(/url\([^#]+#/g, 'url(#')
        .replace('<svg xmlns:xlink="http://www.w3.org/1999/xlink" ', '<svg ')
        .replace(/ href=/g, ' xlink:href=')
        /*.replace(/preserveAspectRatio="none">/g, 'preserveAspectRatio="none"/>')*/
        /* This fails in IE < 8
        .replace(/([0-9]+)\.([0-9]+)/g, function(s1, s2, s3) { // round off to save weight
        return s2 +'.'+ s3[0];
        })*/

        // IE specific
        .replace(/id=([^" >]+)/g, 'id="$1"')
        .replace(/class=([^" ]+)/g, 'class="$1"')
        .replace(/ transform /g, ' ')
        .replace(/:(path|rect)/g, '$1')
        .replace(/<img ([^>]*)>/gi, '<image $1 />')
        .replace(/<\/image>/g, '') // remove closing tags for images as they'll never have any content
        .replace(/<image ([^>]*)([^\/])>/gi, '<image $1$2 />') // closes image tags for firefox
        .replace(/width=(\d+)/g, 'width="$1"')
        .replace(/height=(\d+)/g, 'height="$1"')
        .replace(/hc-svg-href="/g, 'xlink:href="')
        .replace(/style="([^"]+)"/g, function (s) {
          return s.toLowerCase();
        });

      // IE9 beta bugs with innerHTML. Test again with final IE9.
      svg = svg.replace(/(url\(#highcharts-[0-9]+)&quot;/g, '$1')
        .replace(/&quot;/g, "'");
      if (svg.match(/ xmlns="/g).length == 2) {
        svg = svg.replace(/xmlns="[^"]+"/, '');
      }

      return svg;
    }
  </script>
  <style type="text/css">
    @media (min-width: 800px) {
      .container {
        max-width: 800px;
      }
    }

    textarea {
      font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace;
    }

    .tablechart {
      width: 700px;
      margin: auto;
      padding-top: 20px;
      padding-bottom: 20px;
    }

    .chart {
      padding-top: 20px;
      padding-bottom: 20px;
    }

    body {
      padding-top: 70px;
    }
  </style>
</head>

<body>
  <div class="container">
    <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
      <div class="container">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse"
            data-target="#bs-example-navbar-collapse-1">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="https://github.com/fmtlib/dtoa-benchmark"><span
              class="glyphicon glyphicon-home"></span> dtoa-benchmark</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
          <ul class="nav navbar-nav">
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">Configuration <span class="caret"></span></a>
              <ul class="dropdown-menu" role="menu" id="configuration">
              </ul>
            </li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">Section <span class="caret"></span></a>
              <ul class="dropdown-menu" role="menu" id="section">
              </ul>
            </li>
          </ul>
          <p class="navbar-text navbar-right">Developed by <a href="https://github.com/miloyip" class="navbar-link">Milo
              Yip</a></p>
        </div><!-- /.navbar-collapse -->
      </div><!-- /.container-fluid -->
    </nav>
    <div class="page-header">
      <h1 id="title">apple-m1-pro_macos_clang17.0_e0a03f7</h1>
    </div>
    <div id="main"></div>
    <h2>Source CSV</h2>
    <textarea id="textInput" class="form-control" rows="5" readonly>
Type,Function,Digit,Time(ns)
randomdigit,double-conversion,1,59.415833
randomdigit,double-conversion,2,72.494500
randomdigit,double-conversion,3,76.320667
randomdigit,double-conversion,4,77.362542
randomdigit,double-conversion,5,79.895000
randomdigit,double-conversion,6,82.468459
randomdigit,double-conversion,7,84.526916
randomdigit,double-conversion,8,86.936084
randomdigit,double-conversion,9,84.923708
randomdigit,double-conversion,10,82.836000
randomdigit,double-conversion,11,83.470250
randomdigit,double-conversion,12,84.584625
randomdigit,double-conversion,13,86.499666
randomdigit,double-conversion,14,88.861208
randomdigit,double-conversion,15,91.820667
randomdigit,double-conversion,16,95.194917
randomdigit,double-conversion,17,101.179375
randomdigit,dragonbox,1,18.583500
randomdigit,dragonbox,2,19.799292
randomdigit,dragonbox,3,19.530875
randomdigit,dragonbox,4,20.368792
randomdigit,dragonbox,5,19.682584
randomdigit,dragonbox,6,20.554625
randomdigit,dragonbox,7,20.061000
randomdigit,dragonbox,8,20.637291
randomdigit,dragonbox,9,20.075708
randomdigit,dragonbox,10,20.617250
randomdigit,dragonbox,11,20.193917
randomdigit,dragonbox,12,21.101417
randomdigit,dragonbox,13,20.413000
randomdigit,dragonbox,14,22.066750
randomdigit,dragonbox,15,21.345042
randomdigit,dragonbox,16,22.079875
randomdigit,dragonbox,17,24.614917
randomdigit,fmt,1,19.452417
randomdigit,fmt,2,22.863834
randomdigit,fmt,3,20.768584
randomdigit,fmt,4,21.959041
randomdigit,fmt,5,20.410916
randomdigit,fmt,6,21.007500
randomdigit,fmt,7,19.416083
randomdigit,fmt,8,21.512333
randomdigit,fmt,9,22.744208
randomdigit,fmt,10,25.212625
randomdigit,fmt,11,23.142834
randomdigit,fmt,12,24.344125
randomdigit,fmt,13,22.165625
randomdigit,fmt,14,23.770500
randomdigit,fmt,15,21.688708
randomdigit,fmt,16,23.353542
randomdigit,fmt,17,27.481125
randomdigit,null,1,0.938750
randomdigit,null,2,0.929583
randomdigit,null,3,0.929583
randomdigit,null,4,0.930167
randomdigit,null,5,0.929625
randomdigit,null,6,0.929542
randomdigit,null,7,0.929542
randomdigit,null,8,0.930209
randomdigit,null,9,0.929583
randomdigit,null,10,0.929667
randomdigit,null,11,0.929584
randomdigit,null,12,0.931625
randomdigit,null,13,0.929667
randomdigit,null,14,0.929625
randomdigit,null,15,0.929583
randomdigit,null,16,0.929625
randomdigit,null,17,0.929583
randomdigit,ostringstream,1,790.761333
randomdigit,ostringstream,2,806.011333
randomdigit,ostringstream,3,819.296959
randomdigit,ostringstream,4,830.199834
randomdigit,ostringstream,5,841.836208
randomdigit,ostringstream,6,853.736375
randomdigit,ostringstream,7,864.638209
randomdigit,ostringstream,8,873.816000
randomdigit,ostringstream,9,887.428250
randomdigit,ostringstream,10,884.296792
randomdigit,ostringstream,11,891.682292
randomdigit,ostringstream,12,905.404000
randomdigit,ostringstream,13,917.680875
randomdigit,ostringstream,14,924.983958
randomdigit,ostringstream,15,927.393666
randomdigit,ostringstream,16,935.021500
randomdigit,ostringstream,17,930.259417
randomdigit,ryu,1,45.402292
randomdigit,ryu,2,46.117084
randomdigit,ryu,3,45.330250
randomdigit,ryu,4,44.195000
randomdigit,ryu,5,42.670000
randomdigit,ryu,6,41.707875
randomdigit,ryu,7,38.079583
randomdigit,ryu,8,36.802000
randomdigit,ryu,9,35.492208
randomdigit,ryu,10,36.399375
randomdigit,ryu,11,33.529542
randomdigit,ryu,12,32.575208
randomdigit,ryu,13,31.083375
randomdigit,ryu,14,29.924750
randomdigit,ryu,15,29.004959
randomdigit,ryu,16,27.995750
randomdigit,ryu,17,27.902167
randomdigit,schubfach,1,20.408584
randomdigit,schubfach,2,24.090791
randomdigit,schubfach,3,23.610916
randomdigit,schubfach,4,23.475666
randomdigit,schubfach,5,23.114042
randomdigit,schubfach,6,22.986875
randomdigit,schubfach,7,22.673791
randomdigit,schubfach,8,22.498292
randomdigit,schubfach,9,22.325625
randomdigit,schubfach,10,24.473959
randomdigit,schubfach,11,26.189625
randomdigit,schubfach,12,26.060916
randomdigit,schubfach,13,25.831708
randomdigit,schubfach,14,25.591583
randomdigit,schubfach,15,25.422833
randomdigit,schubfach,16,27.295458
randomdigit,schubfach,17,33.113500
randomdigit,sprintf,1,648.973791
randomdigit,sprintf,2,668.549375
randomdigit,sprintf,3,683.536334
randomdigit,sprintf,4,692.828625
randomdigit,sprintf,5,703.847750
randomdigit,sprintf,6,714.632542
randomdigit,sprintf,7,723.714291
randomdigit,sprintf,8,735.424333
randomdigit,sprintf,9,738.026208
randomdigit,sprintf,10,743.900875
randomdigit,sprintf,11,754.317541
randomdigit,sprintf,12,764.324625
randomdigit,sprintf,13,778.053334
randomdigit,sprintf,14,786.505500
randomdigit,sprintf,15,788.153208
randomdigit,sprintf,16,792.107042
randomdigit,sprintf,17,783.284167
randomdigit,to_chars,1,52.038958
randomdigit,to_chars,2,52.725333
randomdigit,to_chars,3,49.936292
randomdigit,to_chars,4,48.516042
randomdigit,to_chars,5,46.836125
randomdigit,to_chars,6,45.804458
randomdigit,to_chars,7,44.643917
randomdigit,to_chars,8,43.011375
randomdigit,to_chars,9,41.586167
randomdigit,to_chars,10,42.752875
randomdigit,to_chars,11,39.603625
randomdigit,to_chars,12,37.992792
randomdigit,to_chars,13,37.030709
randomdigit,to_chars,14,35.961417
randomdigit,to_chars,15,35.493042
randomdigit,to_chars,16,34.756000
randomdigit,to_chars,17,35.935042
randomdigit,xjb64,1,10.818542
randomdigit,xjb64,2,10.567541
randomdigit,xjb64,3,10.716208
randomdigit,xjb64,4,10.588584
randomdigit,xjb64,5,10.682750
randomdigit,xjb64,6,10.657208
randomdigit,xjb64,7,10.609083
randomdigit,xjb64,8,11.006042
randomdigit,xjb64,9,10.540167
randomdigit,xjb64,10,10.827584
randomdigit,xjb64,11,10.884958
randomdigit,xjb64,12,10.749334
randomdigit,xjb64,13,10.688458
randomdigit,xjb64,14,10.665959
randomdigit,xjb64,15,10.785458
randomdigit,xjb64,16,10.515750
randomdigit,xjb64,17,10.614083
randomdigit,yy,1,12.053791
randomdigit,yy,2,12.017584
randomdigit,yy,3,12.043000
randomdigit,yy,4,12.007042
randomdigit,yy,5,15.201250
randomdigit,yy,6,14.129375
randomdigit,yy,7,12.996500
randomdigit,yy,8,12.904541
randomdigit,yy,9,15.044667
randomdigit,yy,10,14.921750
randomdigit,yy,11,14.001916
randomdigit,yy,12,13.913833
randomdigit,yy,13,16.401750
randomdigit,yy,14,15.877125
randomdigit,yy,15,14.905208
randomdigit,yy,16,14.833458
randomdigit,yy,17,14.830709
randomdigit,zmij,1,9.924500
randomdigit,zmij,2,9.907541
randomdigit,zmij,3,9.906208
randomdigit,zmij,4,9.898583
randomdigit,zmij,5,9.906292
randomdigit,zmij,6,9.905416
randomdigit,zmij,7,9.916208
randomdigit,zmij,8,9.914250
randomdigit,zmij,9,10.071917
randomdigit,zmij,10,9.910917
randomdigit,zmij,11,9.905458
randomdigit,zmij,12,9.905708
randomdigit,zmij,13,9.907959
randomdigit,zmij,14,9.901583
randomdigit,zmij,15,9.891625
randomdigit,zmij,16,10.046542
randomdigit,zmij,17,9.918417
</textarea>
  </div>
  <div class="row" id="downloadDD" style="display: none">
    <div class="btn-group pull-right">
      <button class="btn dropdown-toggle" data-toggle="dropdown"><span
          class="glyphicon glyphicon-picture"></span></button>
      <ul class="dropdown-menu">
        <li><a tabindex="-1" href="#" dltype="image/jpeg">JPEG</a></li>
        <li><a tabindex="-1" href="#" dltype="image/png">PNG</a></li>
        <li><a tabindex="-1" href="#" dltype="application/pdf">PDF</a></li>
        <li><a tabindex="-1" href="#" dltype="image/svg+xml">SVG</a></li>
      </ul>
    </div>
  </div>
  <form method="post" action="http://export.highcharts.com/" id="imageGetForm">
    <input type="hidden" name="filename" id="imageFilename" value="" />
    <input type="hidden" name="type" id="imageGetFormTYPE" value="" />
    <input type="hidden" name="width" value="900" />
    <input type="hidden" name="svg" value="" id="imageGetFormSVG" />
  </form>
  </div>
</body>

</html>